(this["webpackJsonpreact-amplified"]=this["webpackJsonpreact-amplified"]||[]).push([[0],{115:function(e,n,t){},116:function(e,n,t){},199:function(e,n,t){"use strict";t.r(n);var o=t(3),a=t(0),c=t.n(a),r=t(10),l=t.n(r),s=(t(115),t.p,t(116),t(16)),i=t.n(s),d=t(32),g=t(20),u=t(36),C=t(67),h=t.n(C),f=t(68),p=t.n(f),j=t(69),S=t(242),b=t(243),v=t(248),E=t(241),m=t(247),T=t(246),O=t(245),I=t(249),x=(t(195),t(234)),R=t(237),w=t(244),y=Object(u.b)((function(e){var n=e.children;return Object(o.jsx)(x.a,{children:Object(o.jsx)(R.a,{elevation:3,children:Object(o.jsx)(w.a,{p:2,m:1,children:n})})})})),k=t(238),A=Object(k.a)((function(e){return{root:{display:"flex"},title:{flexGrow:1},appBarHeader:{zIndex:e.zIndex.drawer+1},footer:{textAlign:"center"},drawer:{width:250,flexShrink:0},drawerHeaderContainer:{textAlign:"center"},drawerPaper:{width:250},drawerContainer:{overflow:"auto"},content:{flexGrow:1,padding:e.spacing(1)},widgetContainer:{p:4}}})),N={STUN_TURN:"stunTurn",TURN_ONLY:"turnOnly",DISABLED:"disabled"},V={MASTER:"MASTER",VIEWER:"VIEWER"},D={WIDESCREEN:"widescreen",FULLSCREEN:"fullscreen"},M=Object(u.a)({accessKey:"",secretAccessKey:"",sessionToken:"",region:"us-west-2",role:V.MASTER,channelName:"ScaryTestChannel",clientId:Math.random().toString(36).substring(2).toUpperCase(),endpoint:null,sendVideo:!0,sendAudio:!0,openDataChannel:!0,resolution:D.WIDESCREEN,natTraversal:N.STUN_TURN,useTrickleICE:!1,messageToSend:"",playerIsStarted:!1,signalingClient:null,localStream:null,localView:null,remoteView:null,dataChannel:null,peerConnectionStatsInterval:null,peerConnectionByClientId:{},dataChannelByClientId:[],receivedMessages:""}),K=Object(u.b)((function(){return M.localView=Object(a.useRef)(null),M.remoteView=Object(a.useRef)(null),Object(a.useEffect)((function(){for(var e=0,n=Object.entries(M);e<n.length;e++){var t=Object(g.a)(n[e],1)[0],o=localStorage.getItem("kvs-widget-".concat(t));o&&(["true","false"].includes(o)&&(o="true"===o),M[t]=o)}}),[]),Object(o.jsxs)(y,{children:[Object(o.jsx)("h2",{children:"Kinesis WebRTC"}),Object(o.jsx)(W,{}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),M.playerIsStarted?Object(o.jsx)(P,{}):null]})})),W=Object(u.b)((function(){var e=A();return Object(o.jsxs)(y,{children:[Object(o.jsx)("h3",{children:"AWS Credentials"}),Object(o.jsx)(T.a,{id:"accessKey",label:"Access Key",onChange:function(e){return H("accessKey",e.target.value)},value:M.accessKey,style:{width:"50%"}}),Object(o.jsx)("br",{}),Object(o.jsx)(T.a,{id:"secretKey",label:"Secret Key",onChange:function(e){return H("secretAccessKey",e.target.value)},value:M.secretAccessKey,style:{width:"50%"}}),Object(o.jsx)("br",{}),Object(o.jsx)(T.a,{id:"sessionToken",label:"Session Token (optional)",onChange:function(e){H("sessionToken",e.target.value)},value:M.sessionToken,style:{width:"50%"}}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),Object(o.jsx)("h3",{children:"WebRTC Configuration"}),Object(o.jsx)(T.a,{id:"region",label:"Region",onChange:function(e){return H("region",e.target.value)},value:M.region}),Object(o.jsx)(T.a,{id:"channelName",label:"Channel name",onChange:function(e){return H("channelName",e.target.value)},value:M.channelName}),Object(o.jsx)(T.a,{id:"clientId",label:"Client ID",onChange:function(e){return H("clientId",e.target.value)},value:M.clientId}),Object(o.jsxs)(E.a,{className:e.formControl,children:[Object(o.jsx)(m.a,{id:"nat-label",children:"NAT Traversal"}),Object(o.jsxs)(b.a,{labelId:"NAT-Traversal",id:"nat-traversal",value:M.natTraversal,onChange:function(e){return H("natTraversal",e.target.value)},children:[Object(o.jsx)(v.a,{value:N.STUN_TURN,children:"STUN/TURN"}),Object(o.jsx)(v.a,{value:N.TURN_ONLY,children:"TURN Only (force cloud relay)"}),Object(o.jsx)(v.a,{value:N.DISABLED,children:"Disabled"})]})]}),Object(o.jsx)(I.a,{control:Object(o.jsx)(O.a,{color:"primary",checked:M.useTrickleICE,onChange:function(e){return H("useTrickleICE",e.target.checked)}}),label:"Trickle ICE",labelPlacement:"top"}),Object(o.jsxs)(E.a,{className:e.formControl,children:[Object(o.jsx)(m.a,{id:"resolution-label",children:"Resolution"}),Object(o.jsxs)(b.a,{labelId:"resolution",id:"resolution",value:M.resolution,onChange:function(e){return H("resolution",e.target.value)},children:[Object(o.jsx)(v.a,{value:D.WIDESCREEN,children:"1280x720 (16:9 widescreen)"}),Object(o.jsx)(v.a,{value:D.FULLSCREEN,children:"640x480 (4:3 fullscreen)"})]})]}),Object(o.jsxs)(E.a,{className:e.formControl,children:[Object(o.jsx)(m.a,{id:"role-label",children:"Role"}),Object(o.jsxs)(b.a,{labelId:"role",id:"role",value:M.role,onChange:function(e){return H("role",e.target.value)},children:[Object(o.jsx)(v.a,{value:V.MASTER,children:"Master"}),Object(o.jsx)(v.a,{value:V.VIEWER,children:"Viewer"})]})]}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),Object(o.jsx)(I.a,{control:Object(o.jsx)(O.a,{color:"primary",checked:M.sendVideo,onChange:function(e){return H("sendVideo",e.target.checked)}}),label:"Send video",labelPlacement:"top"}),Object(o.jsx)(I.a,{control:Object(o.jsx)(O.a,{color:"primary",checked:M.sendAudio,onChange:function(e){return H("sendAudio",e.target.checked)}}),label:"Send audio",labelPlacement:"top"}),Object(o.jsx)(I.a,{control:Object(o.jsx)(O.a,{color:"primary",checked:M.openDataChannel,onChange:function(e){return H("openDataChannel",e.target.checked)}}),label:"Data channel",labelPlacement:"top"}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),M.playerIsStarted?Object(o.jsx)(S.a,{id:"stopPlayer",variant:"contained",color:"primary",onClick:G,children:"Stop player"}):Object(o.jsx)(S.a,{id:"startPlayer",variant:"contained",color:"primary",onClick:U,children:"Start player"})]})})),P=Object(u.b)((function(){return Object(o.jsxs)(y,{children:[Object(o.jsxs)("div",{id:"video-players",className:"d-none",children:[Object(o.jsxs)("div",{className:"row",children:[Object(o.jsxs)("div",{className:"col",children:[Object(o.jsx)("h5",{children:"Output channel"}),Object(o.jsx)("div",{className:"video-container",children:Object(o.jsx)("video",{className:"output-view",ref:M.localView,autoPlay:!0,playsInline:!0,controls:!0,muted:!0})})]}),Object(o.jsxs)("div",{className:"col",children:[Object(o.jsx)("h5",{children:"return Channel"}),Object(o.jsx)("div",{className:"video-container",children:Object(o.jsx)("video",{className:"return-view",ref:M.remoteView,autoPlay:!0,playsInline:!0,controls:!0})})]})]}),Object(o.jsx)(T.a,{id:"messageToSend",label:"DataChannel Message",onChange:function(e){return H("messageToSend",e.target.value)},value:M.messageToSend}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),Object(o.jsx)(S.a,{id:"startPlayer",variant:"contained",color:"primary",onClick:F,children:"Send Message"})]}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),Object(o.jsx)(T.a,{id:"receivedMessages",label:"received messages",value:M.receivedMessages,fullWidth:!0,multiline:!0,rowsMax:10,size:"small",disabled:!0,variant:"outlined"})]})}));function U(){M.playerIsStarted=!0,console.log("role is '".concat(M.role,"'")),M.role===V.MASTER?function(){L.apply(this,arguments)}():function(){B.apply(this,arguments)}()}function L(){return(L=Object(d.a)(i.a.mark((function e(){var n,t,o,a,c,r,l,s,g,u,C;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Creating KVS client..."),n=new h.a({region:M.region,endpoint:M.endpoint||null,correctClockSkew:!0,accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}),console.log("Getting signaling channel ARN..."),e.next=5,n.describeSignalingChannel({ChannelName:M.channelName}).promise();case 5:return t=e.sent,o=t.ChannelInfo.ChannelARN,console.log("[MASTER] Channel ARN: ",o),console.log("Getting signaling channel endpoints..."),e.next=11,n.getSignalingChannelEndpoint({ChannelARN:o,SingleMasterChannelEndpointConfiguration:{Protocols:["WSS","HTTPS"],Role:M.role}}).promise();case 11:return a=e.sent,c=a.ResourceEndpointList.reduce((function(e,n){return e[n.Protocol]=n.ResourceEndpoint,e}),{}),console.log("[MASTER] Endpoints: ",c),console.log("Creating signaling client..."),M.signalingClient=new j.SignalingClient({channelARN:o,channelEndpoint:c.WSS,role:M.role,region:M.region,systemClockOffset:n.config.systemClockOffset,credentials:{accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}}),console.log("Creating ICE server configuration..."),r=new p.a({region:M.region,endpoint:c.HTTPS,correctClockSkew:!0,accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}),console.log("Getting ICE server config..."),e.next=21,r.getIceServerConfig({ChannelARN:o}).promise();case 21:if(l=e.sent,s=[],M.natTraversal===N.STUN_TURN&&(console.log("Getting STUN servers..."),s.push({urls:"stun:stun.kinesisvideo.".concat(M.region,".amazonaws.com:443")})),M.natTraversal!==N.DISABLED&&(console.log("Getting TURN servers..."),l.IceServerList.forEach((function(e){return s.push({urls:e.Uris,username:e.Username,credential:e.Password})}))),g={iceServers:s,iceTransportPolicy:M.natTraversal===N.TURN_ONLY?"relay":"all"},u=M.resolution===N.WIDESCREEN?{width:{ideal:1280},height:{ideal:720}}:{width:{ideal:640},height:{ideal:480}},C={video:!!M.sendVideo&&u,audio:M.sendAudio},!M.sendVideo&&!M.sendAudio){e.next=41;break}return e.prev=29,console.log("Getting user media stream..."),e.next=33,navigator.mediaDevices.getUserMedia(C);case 33:M.localStream=e.sent,M.localView.current.srcObject=M.localStream,e.next=41;break;case 37:e.prev=37,e.t0=e.catch(29),console.log("Error: ",e.t0),console.error("[MASTER] Could not find webcam");case 41:console.log("Adding signalingClient.on open handler..."),M.signalingClient.on("open",Object(d.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[MASTER] Connected to signaling service");case 1:case"end":return e.stop()}}),e)})))),console.log("Adding signalingClient.on sdpOffer handler..."),M.signalingClient.on("sdpOffer",function(){var e=Object(d.a)(i.a.mark((function e(n,t){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[MASTER] Received SDP offer from client: "+t),o=new RTCPeerConnection(g),M.peerConnectionByClientId[t]=o,M.openDataChannel&&(console.log("Opened data channel with ".concat(t)),M.dataChannelByClientId[t]=o.createDataChannel("kvsDataChannel"),o.ondatachannel=function(e){e.channel.onmessage=function(e){var n=(new Date).toISOString(),o="".concat(n," - from ").concat(t,": ").concat(e.data,"\n");console.log(o),M.receivedMessages+=o}}),M.peerConnectionStatsInterval||(M.peerConnectionStatsInterval=setInterval((function(){return o.getStats().then(_)}),1e3)),o.addEventListener("icecandidate",(function(e){var n=e.candidate;n?(console.log("[MASTER] Generated ICE candidate for client: "+t),M.useTrickleICE&&(console.log("[MASTER] Sending ICE candidate to client: "+t),M.signalingClient.sendIceCandidate(n,t))):(console.log("[MASTER] All ICE candidates have been generated for client: "+t),M.useTrickleICE||(console.log("[MASTER] Sending SDP answer to client: "+t),M.signalingClient.sendSdpAnswer(o.localDescription,t)))})),console.log('Adding peerConnection listener for "track"...'),o.addEventListener("track",(function(e){console.log("[MASTER] Received remote track from client: "+t),M.remoteView.current.srcObject||(M.remoteView.current.srcObject=e.streams[0])})),M.localStream&&(console.log("There's no audio/video..."),M.localStream.getTracks().forEach((function(e){return o.addTrack(e,M.localStream)}))),e.next=11,o.setRemoteDescription(n);case 11:return console.log("[MASTER] Creating SDP answer for client: "+t),e.t0=o,e.next=15,o.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 15:return e.t1=e.sent,e.next=18,e.t0.setLocalDescription.call(e.t0,e.t1);case 18:M.useTrickleICE&&(console.log("[MASTER] Sending SDP answer to client: "+t),M.signalingClient.sendSdpAnswer(o.localDescription,t)),console.log("[MASTER] Generating ICE candidates for client: "+t);case 20:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),M.signalingClient.on("iceCandidate",function(){var e=Object(d.a)(i.a.mark((function e(n,t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[MASTER] Received ICE candidate from client: "+t),M.peerConnectionByClientId[t].addIceCandidate(n);case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),M.signalingClient.on("close",(function(){console.log("[MASTER] Disconnected from signaling channel")})),M.signalingClient.on("error",(function(){console.error("[MASTER] Signaling client error")})),console.log("[MASTER] Starting master connection"),M.signalingClient.open();case 50:case"end":return e.stop()}}),e,null,[[29,37]])})))).apply(this,arguments)}function B(){return(B=Object(d.a)(i.a.mark((function e(){var n,t,o,a,c,r,l,s,g,u,C;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Created KVS client..."),n=new h.a({region:M.region,endpoint:M.endpoint||null,correctClockSkew:!0,accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}),console.log("Getting signaling channel ARN..."),e.next=5,n.describeSignalingChannel({ChannelName:M.channelName}).promise();case 5:return t=e.sent,o=t.ChannelInfo.ChannelARN,console.log("[VIEWER] Channel ARN: ",o),console.log("Getting signaling channel endpoints..."),e.next=11,n.getSignalingChannelEndpoint({ChannelARN:o,SingleMasterChannelEndpointConfiguration:{Protocols:["WSS","HTTPS"],Role:M.role}}).promise();case 11:return a=e.sent,c=a.ResourceEndpointList.reduce((function(e,n){return e[n.Protocol]=n.ResourceEndpoint,e}),{}),console.log("[VIEWER] Endpoints: ",c),console.log("Creating signaling client..."),M.signalingClient=new j.SignalingClient({channelARN:o,channelEndpoint:c.WSS,role:M.role,region:M.region,systemClockOffset:n.config.systemClockOffset,clientId:M.clientId,credentials:{accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}}),console.log("Creating ICE server configuration..."),r=new p.a({region:M.region,endpoint:c.HTTPS,correctClockSkew:!0,accessKeyId:M.accessKey,secretAccessKey:M.secretAccessKey,sessionToken:M.sessionToken||null}),console.log("Getting ICE server config response..."),e.next=21,r.getIceServerConfig({ChannelARN:o}).promise();case 21:l=e.sent,s=[],M.natTraversal===N.STUN_TURN&&(console.log("Getting STUN servers..."),s.push({urls:"stun:stun.kinesisvideo.".concat(M.region,".amazonaws.com:443")})),M.natTraversal!==N.DISABLED&&(console.log("Getting TURN servers..."),l.IceServerList.forEach((function(e){return s.push({urls:e.Uris,username:e.Username,credential:e.Password})}))),g={iceServers:s,iceTransportPolicy:M.natTraversal===N.TURN_ONLY?"relay":"all"},u=M.resolution===N.WIDESCREEN?{width:{ideal:1280},height:{ideal:720}}:{width:{ideal:640},height:{ideal:480}},C={video:!!M.sendVideo&&u,audio:M.sendAudio},M.peerConnection=new RTCPeerConnection(g),M.openDataChannel&&(console.log("Opened data channel with MASTER."),M.dataChannel=M.peerConnection.createDataChannel("kvsDataChannel"),M.peerConnection.ondatachannel=function(e){e.channel.onmessage=function(e){var n=(new Date).toISOString(),t="".concat(n," - from MASTER: ").concat(e.data,"\n");console.log(t),M.receivedMessages+=t}}),M.peerConnectionStatsInterval=setInterval((function(){M.peerConnection.getStats().then(_)}),1e3),M.signalingClient.on("open",Object(d.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[VIEWER] Connected to signaling service"),!M.sendVideo&&!M.sendAudio){e.next=14;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia(C);case 5:M.localStream=e.sent,M.localStream.getTracks().forEach((function(e){return M.peerConnection.addTrack(e,M.localStream)})),M.localView.current.srcObject=M.localStream,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(2),console.error("[VIEWER] Could not find webcam"),e.abrupt("return");case 14:return console.log("[VIEWER] Creating SDP offer"),e.t1=M.peerConnection,e.next=18,M.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 18:return e.t2=e.sent,e.next=21,e.t1.setLocalDescription.call(e.t1,e.t2);case 21:M.useTrickleICE&&(console.log("[VIEWER] Sending SDP offer"),M.signalingClient.sendSdpOffer(M.peerConnection.localDescription)),console.log("[VIEWER] Generating ICE candidates");case 23:case"end":return e.stop()}}),e,null,[[2,10]])})))),M.signalingClient.on("sdpAnswer",function(){var e=Object(d.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[VIEWER] Received SDP answer"),e.next=3,M.peerConnection.setRemoteDescription(n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),M.signalingClient.on("iceCandidate",(function(e){console.log("[VIEWER] Received ICE candidate"),M.peerConnection.addIceCandidate(e)})),M.signalingClient.on("close",(function(){console.log("[VIEWER] Disconnected from signaling channel")})),M.signalingClient.on("error",(function(e){console.error("[VIEWER] Signaling client error: ",e)})),M.peerConnection.addEventListener("icecandidate",(function(e){var n=e.candidate;n?(console.log("[VIEWER] Generated ICE candidate"),M.useTrickleICE&&(console.log("[VIEWER] Sending ICE candidate"),M.signalingClient.sendIceCandidate(n))):(console.log("[VIEWER] All ICE candidates have been generated"),M.useTrickleICE||(console.log("[VIEWER] Sending SDP offer"),M.signalingClient.sendSdpOffer(M.peerConnection.localDescription)))})),M.peerConnection.addEventListener("track",(function(e){console.log("[VIEWER] Received remote track"),M.remoteView.current.srcObject||(M.remoteStream=e.streams[0],M.remoteView.current.srcObject=M.remoteStream)})),console.log("[VIEWER] Starting viewer connection"),M.signalingClient.open();case 40:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){M.playerIsStarted=!1,console.log("role is '".concat(M.role,"'")),M.role===V.MASTER?function(){console.log("[MASTER] Stopping master connection"),M.signalingClient&&(M.signalingClient.close(),M.signalingClient=null);Object.keys(M.peerConnectionByClientId).forEach((function(e){M.peerConnectionByClientId[e].close()})),M.peerConnectionByClientId=[],M.localStream&&(M.localStream.getTracks().forEach((function(e){return e.stop()})),M.localStream=null);M.peerConnectionStatsInterval&&(clearInterval(M.peerConnectionStatsInterval),M.peerConnectionStatsInterval=null);M.localView&&(M.localView.current.srcObject=null);M.remoteView&&(M.remoteView.current.srcObject=null);M.dataChannelByClientId&&(M.dataChannelByClientId={})}():function(){console.log("[VIEWER] Stopping viewer connection"),M.signalingClient&&(M.signalingClient.close(),M.signalingClient=null);M.peerConnection&&(M.peerConnection.close(),M.peerConnection=null);M.localStream&&(M.localStream.getTracks().forEach((function(e){return e.stop()})),M.localStream=null);M.remoteStream&&(M.remoteStream.getTracks().forEach((function(e){return e.stop()})),M.remoteStream=null);M.peerConnectionStatsInterval&&(clearInterval(M.peerConnectionStatsInterval),M.peerConnectionStatsInterval=null);M.localView&&(M.localView.current.srcObject=null);M.remoteView&&(M.remoteView.current.srcObject=null);M.dataChannel&&(M.dataChannel=null)}()}function _(e){}function F(){if(M.role===V.MASTER)Object.keys(M.dataChannelByClientId).forEach((function(e){try{M.dataChannelByClientId[e].send(M.messageToSend),console.log("Message sent to client ".concat(e,": ").concat(M.messageToSend))}catch(n){console.error("[MASTER] Send DataChannel: ",n.toString())}}));else if(M.dataChannel)try{M.dataChannel.send(M.messageToSend),console.log("Message sent to master: ".concat(M.messageToSend))}catch(e){console.error("[VIEWER] Send DataChannel: ",e.toString())}}function H(e,n){M[e]=n;var t="kvs-widget-".concat(e);localStorage.setItem(t,n)}var z=K;var Y=function(){return Object(o.jsx)(z,{})},J=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,252)).then((function(n){var t=n.getCLS,o=n.getFID,a=n.getFCP,c=n.getLCP,r=n.getTTFB;t(e),o(e),a(e),c(e),r(e)}))};l.a.render(Object(o.jsx)(c.a.Fragment,{children:Object(o.jsx)(Y,{})}),document.getElementById("root")),J()},65:function(e,n){}},[[199,1,2]]]);
//# sourceMappingURL=main.855d7106.chunk.js.map